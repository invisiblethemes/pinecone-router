function t(){return(t=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t}).apply(this,arguments)}var e=function(t,e){void 0===e&&(e=[]),this.params={},this.path=t,this.handlers=e},n=window.location;function o(t,e,n){return{route:t,path:e,params:n,query:window.location.search.substring(1),hash:window.location.hash.substring(1),redirect:function(t){return window.PineconeRouter.navigate(t),"stop"}}}function r(t){return t.replace(/(^\/+|\/+$)/g,"").split("/")}function i(t){if(window.PineconeRouterMiddlewares)for(var e in window.PineconeRouterMiddlewares){var n=window.PineconeRouterMiddlewares[e];if(null==n[t])return;var o=n[t].apply(n,[].slice.call(arguments,1));if("stop"==o)return"stop"}}var a={name:"pinecone-router",version:"1.0.3",routes:[],settings:{hash:!1,basePath:"/",allowNoHandler:!1,middlewares:{}},currentContext:{},notfound:new e("notfound"),start:function(){var e=this;if(!window.Alpine)throw new Error("Alpine is required for "+this.name+" to work.");var n=0;window.Alpine.onComponentInitialized(function(o){if(o.$el.hasAttribute("x-router")){var r;if(n>1)throw new Error(e.name+": Only one router can be in a page.");if(e.settings=t({},e.settings,null!=(r=o.getUnobservedData().settings)?r:{}),i("init",o,e.settings),Array.from(o.$el.children).filter(function(t){return"template"==t.tagName.toLowerCase()}).forEach(function(t){return e.processRoute(t,o)}),n++,!e.settings.hash)return e.navigate(window.location.pathname,!1,!0);e.navigate(window.location.hash.substring(1),!0,!0)}}),this.interceptLinks(this),window.addEventListener("popstate",function(){e.settings.hash?""!=window.location.hash&&e.navigate(window.location.hash.substring(1),!0):e.navigate(window.location.pathname,!0)}),window.Alpine.addMagicProperty("router",function(){return window.PineconeRouter.currentContext})},processRoute:function(t,e){var n,o=null!=(n=t.getAttribute("x-route"))?n:"/";if(o.indexOf("#")>-1)throw new Error(this.name+": A route's path may not have a hash character.");i("onBeforeRouteProcessed",t,e,o);var r,a,s,u=[];if(!t.hasAttribute("x-handler")&&!this.settings.allowNoHandler)throw new Error(this.name+": Routes must have a handler.");if(t.hasAttribute("x-handler")){var h=(r=t.getAttribute("x-handler"),a=e.$data,void 0===s&&(s={}),new Function(["$data"].concat(Object.keys(s)),"var __alpine_result; with($data) { __alpine_result = "+r+" }; return __alpine_result").apply(void 0,[a].concat(Object.values(s))));if("function"==typeof h)u=[h];else{if("object"!=typeof h)throw new Error(this.name+": Invalid handler type: "+typeof h+".");u=h}"notfound"==o&&(this.notfound.handlers=u)}"notfound"!=o&&("/"!=this.settings.basePath&&(o=this.settings.basePath+o),this.add(o,u))},validLink:function(t,e){for(var o,r={valid:!1,link:""};t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;if(!t||"A"!==t.nodeName.toUpperCase())return r;var i="object"==typeof t.href&&"SVGAnimatedString"===t.href.constructor.name;return t.hasAttribute("download")||"external"===t.getAttribute("rel")?r:(r.link=null!=(o=t.getAttribute("href"))?o:"",e||!function(t){if(!n)return!1;var e=window.location;return t.pathname===e.pathname&&t.search===e.search}(t)||!t.hash&&"#"!==r.link?r.link&&r.link.indexOf("mailto:")>-1||(i?t.target.baseVal:t.target)?r:i||function(t){if(!t||!n)return!1;var e=function(t){if("function"==typeof URL&&n)return new URL(t,window.location.toString());var e=window.document.createElement("a");return e.href=t,e}(t),o=window.location;return o.protocol===e.protocol&&o.hostname===e.hostname&&(o.port===e.port||""===o.port&&("80"==e.port||"443"==e.port))}(t.href)?(r.valid=!0,r):r:r)},interceptLinks:function(t){window.document.body.addEventListener(document.ontouchstart?"touchstart":"click",function(e){if(!(e.metaKey||e.ctrlKey||e.shiftKey||1!=e.detail||e.defaultPrevented)){var n=e.target,o=e.path||(e.composedPath?e.composedPath():null);if(o)for(var r=0;r<o.length;r++)if(o[r].nodeName&&"A"===o[r].nodeName.toUpperCase()&&o[r].href){n=o[r];break}if(!n.hasAttribute("native")){var i=t.validLink(n,t.settings.hash);i.valid&&(t.navigate(i.link),e.preventDefault())}}})},navigate:function(t,e,n){var a;void 0===e&&(e=!1),void 0===n&&(n=!1),null!=t||(t="/"),"/"==this.settings.basePath||t.startsWith(this.settings.basePath)||(t=this.settings.basePath+t),t!=this.settings.basePath||t.endsWith("/")||(t+="/");var s=this.routes.find(function(e){var n=function(t,e){var n,o=/(?:\?([^#]*))?(#.*)?$/,i=t.match(o),a={};if(i&&i[1])for(var s=i[1].split("&"),u=0;u<s.length;u++){var h=s[u].split("=");a[decodeURIComponent(h[0])]=decodeURIComponent(h.slice(1).join("="))}for(var d=r(t.replace(o,"")),l=r(e||""),c=Math.max(d.length,l.length),f=0;f<c;f++)if(l[f]&&":"===l[f].charAt(0)){var p=l[f].replace(/(^:|[+*?]+$)/g,""),w=(l[f].match(/[+*?]+$/)||{}).toString()[0],v=~w.indexOf("+"),g=~w.indexOf("*"),m=d[f]||"";if(!m&&!g&&(w.indexOf("?")<0||v)){n=!1;break}if(a[p]=decodeURIComponent(m),v||g){a[p]=d.slice(f).map(decodeURIComponent).join("/");break}}else if(l[f]!==d[f]){n=!1;break}return!1!==n&&a}(t,e.path);return e.params=0!=n?n:{},n}),u=void 0===s?o("notfound",t,[]):o(s.path,t,s.params);if(this.currentContext=u,"stop"!=i("onBeforeHandlersExecuted",s,t,n)){if(!e){var h="";this.settings.hash?(h="#","/"!=window.location.pathname&&(h+=window.location.pathname),h+=window.location.search+t):h=t+window.location.search+window.location.hash,history.pushState({path:h},"",h)}(function(t,e){for(var n=0;n<t.length;n++)if("function"==typeof t[n]&&"stop"==t[n](e))return!1;return!0})(null!=(a=null==s?void 0:s.handlers)?a:this.notfound.handlers,u)&&i("onHandlersExecuted",s,t,n)}},add:function(t,n){if(null!=this.routes.find(function(e){return e.path==t}))throw new Error("Pinecone Router: route already exist");this.routes.push(new e(t,n))},remove:function(t){this.routes=this.routes.filter(function(e){return e.path!=t})}},s=window.deferLoadingAlpine||function(t){return t()};window.PineconeRouter=a,window.deferLoadingAlpine=function(t){window.PineconeRouter.start(),s(t)},module.exports=a;
//# sourceMappingURL=index.js.map
