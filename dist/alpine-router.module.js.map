{"version":3,"file":"alpine-router.module.js","sources":["../src/index.js"],"sourcesContent":["const AlpineRouter = {\n\troutes: [],\n\tisLocation: !!(window.history.location || window.location),\n\tnotfound: function () {\n\t\tconsole.log('Alpine Router: not found');\n\t},\n\n\tstart() {\n\t\tif (!window.Alpine) {\n\t\t\tthrow new Error('Alpine is require for `Alpine Router` to work.');\n\t\t}\n\n\t\t// Whenever a component is initialized, check if it is a router\n\t\t// and run test the children if they're valid routes\n\t\tAlpine.onComponentInitialized((component) => {\n\t\t\tif (component.$el.hasAttribute('x-router')) {\n\t\t\t\tArray.from(component.$el.children).forEach((el) => {\n\t\t\t\t\tif (el.hasAttribute('x-route')) {\n\t\t\t\t\t\tthis.processRoute(el, component);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\n\t\t// Intercept click event in links\n\t\tdocument.querySelectorAll('a').forEach((el) => {\n\t\t\t// Taken from page.js https://github.com/visionmedia/page.js/blob/master/index.js#L370\n\t\t\t// el.nodeName for svg links are 'a' instead of 'A'\n\t\t\twhile (el && 'A' !== el.nodeName.toUpperCase()) el = el.parentNode;\n\t\t\tif (!el || 'A' !== el.nodeName.toUpperCase()) return;\n\n\t\t\t// check if link is inside an svg\n\t\t\t// in this case, both href and target are always inside an object\n\t\t\tvar svg =\n\t\t\t\ttypeof el.href === 'object' &&\n\t\t\t\tel.href.constructor.name === 'SVGAnimatedString';\n\n\t\t\t// Ignore if tag has\n\t\t\t// 1. \"download\" attribute\n\t\t\t// 2. rel=\"external\" attribute\n\t\t\tif (\n\t\t\t\tel.hasAttribute('download') ||\n\t\t\t\tel.getAttribute('rel') === 'external'\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar link = el.getAttribute('href');\n\n\t\t\t// Check for mailto: in the href\n\t\t\tif (link && link.indexOf('mailto:') > -1) return;\n\n\t\t\t// check target\n\t\t\t// svg target is an object and its desired value is in .baseVal property\n\t\t\tif (svg ? el.target.baseVal : el.target) return;\n\n\t\t\t// x-origin\n\t\t\t// note: svg links that are not relative don't call click events (and skip page.js)\n\t\t\t// consequently, all svg links tested inside page.js are relative and in the same origin\n\t\t\tif (!svg && !this.sameOrigin(el.href)) return;\n\n\t\t\tel.addEventListener(\n\t\t\t\t'click',\n\t\t\t\t(e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.navigate(e.target.getAttribute('href'));\n\t\t\t\t},\n\t\t\t\tfalse\n\t\t\t);\n\t\t});\n\t\t\n\t\twindow.addEventListener('popstate', (e) => router.navigate(e.detail));\n\t\n\t\t// navigate to the current page to handle it\n\t\tthis.navigate(location.pathname + location.hash);\n\t},\n\n\t/**\n\t * Take the template element of a route and the router component\n\t * and test if it can be added or not\n\t */\n\tprocessRoute(el, component) {\n\t\tif (el.tagName.toLowerCase() !== 'template') {\n\t\t\tthrow new Error(\n\t\t\t\t'Alpine Router: x-routes must be used on a template tag.'\n\t\t\t);\n\t\t}\n\n\t\tif (el.hasAttribute('x-handler') == false) {\n\t\t\tthrow new Error(\n\t\t\t\t'Alpine Router: x-route must have a handler (x-handler=\"handler\")'\n\t\t\t);\n\t\t}\n\n\t\tlet path = el.getAttribute('x-route');\n\t\tlet handlerName = el.getAttribute('x-handler');\n\t\tlet handler = component.getUnobservedData()[handlerName];\n\n\t\tif (path == 'notfound') {\n\t\t\t// register the route as a 404 handler\n\t\t\tthis.notfound = handler;\n\t\t} else {\n\t\t\t// register the new route.\n\t\t\tthis.routes.push(new Route(path, handler));\n\t\t}\n\t},\n\n\t/**\n\t * Match the path with specified routes\n\t * https://github.com/vijitail/simple-javascript-router/blob/master/src/router/Router.js#L14\n\t */\n\tmatch(route, requestPath) {\n\t\tlet paramNames = [];\n\t\tlet regexPath =\n\t\t\troute.path.replace(/([:*])(\\w+)/g, (_full, _colon, name) => {\n\t\t\t\tparamNames.push(name);\n\t\t\t\treturn '([^/]+)';\n\t\t\t}) + '(?:/|$)';\n\n\t\tlet params = {};\n\t\tlet routeMatch = requestPath.match(new RegExp(regexPath));\n\t\tif (routeMatch !== null) {\n\t\t\tparams = routeMatch.slice(1).reduce((params, value, index) => {\n\t\t\t\tif (params === null) params = {};\n\t\t\t\tparams[paramNames[index]] = value;\n\t\t\t\treturn params;\n\t\t\t}, null);\n\t\t}\n\n\t\troute.setProps(params);\n\n\t\treturn routeMatch;\n\t},\n\n\t/**\n\t * Go to the specified path without reloading\n\t * https://github.com/vijitail/simple-javascript-router/blob/master/src/router/Router.js#L37\n\t */\n\tnavigate(path) {\n\t\tconst route = this.routes.filter((route) => this.match(route, path))[0];\n\t\tif (!route) this.notfound();\n\t\telse {\n\t\t\thistory.pushState({}, '', path);\n\t\t\troute.handle();\n\t\t}\n\t},\n\n\t/**\n\t * Convert to a URL object\n\t * https://github.com/visionmedia/page.js/blob/4f9991658f9b9e3de9b6059bade93693af24d6bd/page.js#L888\n\t */\n\t_toURL(href) {\n\t\tif (typeof URL === 'function' && this.isLocation) {\n\t\t\treturn new URL(href, window.location.toString());\n\t\t} else {\n\t\t\tvar anc = window.document.createElement('a');\n\t\t\tanc.href = href;\n\t\t\treturn anc;\n\t\t}\n\t},\n\n\t/**\n\t * Check if `href` is the same origin.\n\t * https://github.com/visionmedia/page.js/blob/4f9991658f9b9e3de9b6059bade93693af24d6bd/page.js#L888\n\t */\n\tsameOrigin(href) {\n\t\tif (!href || !this.isLocation) return false;\n\n\t\tvar url = this._toURL(href);\n\t\tvar loc = window.location;\n\n\t\t/*\n\t\t   When the port is the default http port 80 for http, or 443 for\n\t\t   https, internet explorer 11 returns an empty string for loc.port,\n\t\t   so we need to compare loc.port with an empty string if url.port\n\t\t   is the default port 80 or 443.\n\t\t   Also the comparition with `port` is changed from `===` to `==` because\n\t\t   `port` can be a string sometimes. This only applies to ie11.\n\t\t*/\n\t\treturn (\n\t\t\tloc.protocol === url.protocol &&\n\t\t\tloc.hostname === url.hostname &&\n\t\t\t(loc.port === url.port ||\n\t\t\t\t(loc.port === '' && (url.port == 80 || url.port == 443)))\n\t\t); // jshint ignore:line\n\t},\n\t_samePath(url) {\n\t\tif (!this.isLocation) return false;\n\t\tvar loc = window.location;\n\t\treturn url.pathname === loc.pathname && url.search === loc.search;\n\t},\n};\n\nclass Route {\n\tconstructor(path, handler) {\n\t\tthis.path = path;\n\t\tthis.handler = handler;\n\t}\n\n\tsetProps(newProps) {\n\t\tthis.props = newProps;\n\t}\n\n\thandle() {\n\t\treturn this.handler(this.props);\n\t}\n}\n\nconst alpine = window.deferLoadingAlpine || ((callback) => callback());\n\nwindow.AlpineRouter = AlpineRouter;\n\nwindow.deferLoadingAlpine = function (callback) {\n\twindow.AlpineRouter.start();\n\n\talpine(callback);\n};\n\nexport default AlpineRouter;\n"],"names":["AlpineRouter","routes","isLocation","window","history","location","notfound","console","log","start","Alpine","Error","onComponentInitialized","component","$el","hasAttribute","Array","from","children","forEach","el","this","processRoute","document","querySelectorAll","nodeName","toUpperCase","parentNode","svg","href","constructor","name","getAttribute","link","indexOf","target","baseVal","sameOrigin","addEventListener","e","preventDefault","navigate","router","detail","pathname","hash","tagName","toLowerCase","path","handlerName","handler","getUnobservedData","push","Route","match","route","requestPath","paramNames","regexPath","replace","_full","_colon","params","routeMatch","RegExp","slice","reduce","value","index","setProps","filter","pushState","handle","_toURL","URL","toString","anc","createElement","url","loc","protocol","hostname","port","_samePath","search","newProps","props","alpine","deferLoadingAlpine","callback"],"mappings":"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"}