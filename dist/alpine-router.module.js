class t{constructor(t,e,r){this.path=t,this.handler=e,this.router=r}setProps(t){this.props=t}handle(){return this.handler({props:this.props,path:this.path})}}class e{constructor(t,e){this.name=t,this.settings=e}}const r={isLocation:!(!window.history.location&&!window.location),validLink(t){for(;t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;if(!t||"A"!==t.nodeName.toUpperCase())return!1;var e="object"==typeof t.href&&"SVGAnimatedString"===t.href.constructor.name;if(t.hasAttribute("download")||"external"===t.getAttribute("rel"))return!1;var r=t.getAttribute("href");return!(r&&r.indexOf("mailto:")>-1||(e?t.target.baseVal:t.target)||!e&&!this.sameOrigin(t.href))},processRoutersInFetchedDoc(t,e,r,n=!0){let o=[];Array.from(t.querySelectorAll("[x-router]")).forEach(t=>{let r=t.getAttribute("x-router");""==r&&(r="default"),o.push(r),-1!=e.findIndex(t=>t.name==r)&&t.remove()});let i=e.filter(t=>!(-1!=o.findIndex(e=>e==t.name)));return n&&i.length>0&&(r=r.filter(t=>i.includes(t.router)),e=e.filter(t=>i.includes(t.name))),{doc:t,routers:e,routes:r}},match(t,e){let r=[],n=t.path.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&").replace(/([:^\s])(\w+)/g,(t,e,n)=>(r.push(n),"([^/]+)"))+"(?:/|$)",o={},i=e.match(new RegExp(n));if(null!==i){if(0!=i.index)return null;if(i.input!=i[0])return null;o=i.slice(1).reduce((t,e,n)=>(null===t&&(t={}),t[r[n]]=e,t),null)}return t.setProps(o),i},toURL(t){if("function"==typeof URL&&this.isLocation)return new URL(t,window.location.toString());var e=window.document.createElement("a");return e.href=t,e},sameOrigin(t){if(!t||!this.isLocation)return!1;var e=this.toURL(t),r=window.location;return r.protocol===e.protocol&&r.hostname===e.hostname&&(r.port===e.port||""===r.port&&(80==e.port||443==e.port))},samePath(t){if(!this.isLocation)return!1;var e=window.location;return t.pathname===e.pathname&&t.search===e.search},detectRouterSettings(t){let e={};if(t.hasAttribute("x-base")&&(e.base=t.getAttribute("x-base")),t.hasAttribute("x-render")){let r=t.getAttribute("x-render");e.render=""==r?"body":r}return t.hasAttribute("x-render")&&(e.render=""==t.getAttribute("x-render")?"body":t.getAttribute("x-render")),e}},n={routes:[],routers:[],settings:{interceptLinks:!0,basepath:"/",hash:!1},loaded:!1,fetchedContent:{path:null,content:null},preloadPages:!1,notfound:function(t){console.error(`Alpine Router: requested path ${t} was not found`)},start(){if(!window.Alpine)throw new Error("Alpine is require for `Alpine Router` to work.");this.routerloaded=new Event("routerloaded"),this.loadstart=new Event("loadstart"),this.loadend=new Event("loadend");let t=document.querySelectorAll("[x-data][x-router]").length,n=0;Alpine.onComponentInitialized(o=>{if(o.$el.hasAttribute("x-router")){let i=o.$el.getAttribute("x-router");if("string"!=typeof i&&(console.warn('Alpine Router: x-router attribute should be a string of the router name or empty for "default".'),i="default"),""==i&&(i="default",o.$el.setAttribute("x-router",i)),"string"!=typeof i&&(console.warn("Alpine Router: x-router attribute should be a string of the router name or empty for default"),i="default"),this.routers.findIndex(t=>t.name==i)>-1)throw new Error(`Alpine Router: A router with the name ${i} already exist. Use a different name by setting the attribute x-router to another value`);let s=r.detectRouterSettings(o.$el);if(this.preloadPages||null==s.render||(this.preloadPages=!0),Array.from(o.$el.children).forEach(t=>{t.hasAttribute("x-route")&&this.processRoute(t,o,i,s)}),this.routers.push(new e(i,s)),n++,n==t){if(this.settings.hash){if(""==window.location.hash)return void(document.location.href=window.location.pathname+"#/");this.navigate(window.location.hash.substring(1),!0,!0)}else this.navigate(window.location.pathname,!1,!0);this.loaded=!0,window.dispatchEvent(this.routerloaded)}}}),this.interceptLinks(),window.addEventListener("popstate",()=>{this.settings.hash?""!=window.location.hash&&this.navigate(window.location.hash.substring(1),!0):this.navigate(window.location.pathname,!0)})},interceptLinks(){this.settings.interceptLinks&&document.querySelectorAll("a").forEach(t=>{t.hasAttribute("x-link")||0!=r.validLink(t)&&(t.setAttribute("x-link",""),t.addEventListener("mouseover",t=>{if(!this.preloadPages)return;let e=t.target.getAttribute("href");null!=this.fetchedContent.path&&this.fetchedContent.path==e||window.setTimeout(function(){fetch(e).then(t=>t.text()).then(t=>{window.AlpineRouter.fetchedContent.path=e,window.AlpineRouter.fetchedContent.content=t})},this.settings.hoverFetchTime)}),t.addEventListener("click",t=>{t.preventDefault();let e=t.target.getAttribute("href");this.settings.hash?window.location.hash="#"+e:this.navigate(e)},!1))})},processRoute(e,n,o,i){if("template"!==e.tagName.toLowerCase())throw new Error("Alpine Router: x-route must be used on a template tag.");if(0==e.hasAttribute("x-handler"))throw new Error('Alpine Router: x-route must have a handler (x-handler="handler")');let s=e.getAttribute("x-route");if("string"!=typeof s)throw new Error(`Alpine Router: x-route must be a string, ${typeof s} given.`);if(s.indexOf("#")>-1)throw new Error("Alpine Router: A route's path may not have a hash, setting AlpineRouter.settings.hash to true is sufficiant.");let a,h=e.getAttribute("x-handler");try{a=n.getUnobservedData()[h]}catch(t){throw new Error("Alpine Router: "+t)}if("function"!=typeof a)throw new Error(`Alpine Router: handler must be a callback function, ${typeof a} given.`);if("notfound"==s)this.notfound=a;else{if(0==["/","#/"].includes(this.settings.basepath)&&(s=this.settings.basepath+s),null!=i.base&&(s=i.base+s),1==this.routes.filter(t=>r.match(t,s)).forEach(t=>{if(t.router==o)return!0}))throw new Error("Alpine Router: Route `${path}` is already registered on router `${routerName}`.");this.routes.push(new t(s,a,o))}},navigate(t,e=!1,n=!1){window.dispatchEvent(this.loadstart),null==t&&(t="/");const o=this.routes.filter(e=>r.match(e,t));if(0==o.length&&this.notfound(t),!e){let e;e=this.settings.hash?window.location.pathname+window.location.search+t:t+window.location.search+window.location.hash,history.pushState({path:e},"",e)}o.forEach(e=>{if(1!=n){let r=this.routers.find(t=>t.name==e.router);if(null!=r.settings.render){let e=r.settings.render;null!=this.fetchedContent.path&&this.fetchedContent.path==t?(console.log("Alpine Router: Using preloaded conteent"),this.renderEntirePage(this.fetchedContent.content,e),this.fetchedContent.path=null,this.fetchedContent.content=null):fetch(t).then(t=>t.text()).then(t=>{this.renderEntirePage(t,e)}),this.rendered=!0}}e.handle()}),window.dispatchEvent(this.loadend)},renderEntirePage(t,e){let n=(new DOMParser).parseFromString(t,"text/html");n=n.querySelector(e);let o=r.processRoutersInFetchedDoc(n,this.routers,this.routes,!0);n=o.doc,this.routers=o.routers,this.routes=o.routes,this.preloadPages=null!=this.routers.findIndex(t=>null!=t.settings.render),document.querySelector(e).innerHTML=n.innerHTML,this.interceptLinks()},renderChunks(){}},o=window.deferLoadingAlpine||(t=>t());window.AlpineRouter=n,window.deferLoadingAlpine=function(t){window.AlpineRouter.start(),o(t)};export default n;
//# sourceMappingURL=alpine-router.module.js.map
