{"version":3,"file":"index.umd.js","sources":["../src/route.ts","../src/utils.ts","../src/index.ts"],"sourcesContent":["class Route {\n\tparams = {};\n\tpath: string;\n\thandlers: Array<Function>;\n\tconstructor(path: string, handlers: Array<Function>) {\n\t\tthis.path = path;\n\t\tthis.handlers = handlers;\n\t}\n}\n\nexport default Route;\n","var isLocation = window.location;\n\n/**\n * Create the context object\n */\nexport function buildContext(route: string, path: string, params: {}): object {\n\treturn {\n\t\troute: route,\n\t\tpath: path,\n\t\tparams: params,\n\t\tquery: window.location.search.substring(1), // query w/out leading '?'\n\t\thash: window.location.hash.substring(1), // hash without leading '#'\n\t\tredirect: (path: string): string => {\n\t\t\twindow.PineconeRouter.navigate(path);\n\t\t\t// returning 'stop' will stop the navigate function\n\t\t\t// and return before calling any middleware.\n\t\t\treturn 'stop';\n\t\t},\n\t};\n}\n\n/**\n * taken from preact-router\n * https://github.com/preactjs/preact-router\n * @param url url to segmentize\n * @returns \n */\nfunction segmentize(url: string): string[] {\n\treturn url.replace(/(^\\/+|\\/+$)/g, '').split('/');\n}\n\n/**\n * check if a path match with this route\n * taken from preact-router\n * https://github.com/preactjs/preact-router\n * @param path {string}\n * @param routePath {string}\n * @returns {boolean}\n */\nexport function match(url: string, routePath: string): false | object {\n\tlet reg = /(?:\\?([^#]*))?(#.*)?$/,\n\t\tc = url.match(reg),\n\t\tmatches: any = {},\n\t\tret;\n\tif (c && c[1]) {\n\t\tlet p = c[1].split('&');\n\t\tfor (let i = 0; i < p.length; i++) {\n\t\t\tlet r = p[i].split('=');\n\t\t\tmatches[decodeURIComponent(r[0])] = decodeURIComponent(\n\t\t\t\tr.slice(1).join('=')\n\t\t\t);\n\t\t}\n\t}\n\tlet urlSeg = segmentize(url.replace(reg, ''));\n\tlet route: string[] = segmentize(routePath || '');\n\tlet max = Math.max(urlSeg.length, route.length);\n\tfor (let i = 0; i < max; i++) {\n\t\tif (route[i] && route[i].charAt(0) === ':') {\n\t\t\tlet param: string = route[i].replace(/(^:|[+*?]+$)/g, '');\n\t\t\tlet flags: string = (route[i].match(/[+*?]+$/) || {}).toString()[0];\n\t\t\tlet plus = ~flags.indexOf('+');\n\t\t\tlet star = ~flags.indexOf('*');\n\t\t\tlet val = urlSeg[i] || '';\n\t\t\tif (!val && !star && (flags.indexOf('?') < 0 || plus)) {\n\t\t\t\tret = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmatches[param] = decodeURIComponent(val);\n\t\t\tif (plus || star) {\n\t\t\t\tmatches[param] = urlSeg\n\t\t\t\t\t.slice(i)\n\t\t\t\t\t.map(decodeURIComponent)\n\t\t\t\t\t.join('/');\n\t\t\t\tbreak;\n\t\t\t}\n\t\t} else if (route[i] !== urlSeg[i]) {\n\t\t\tret = false;\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (ret === false) return false;\n\treturn matches;\n}\n/**\n * Call a function on all middlewares loaded, if any.\n * @param {string} func middleware function to call.\n * @param {any} args arguments to pass to the function.\n * @returns {boolean} false if the middleware function return false, i.e. it want to stop execution of the function and return.\n */\nexport function middleware(func: string, ...args: any): string | undefined {\n\tif (window.PineconeRouterMiddlewares == null) return;\n\tfor (const i in window.PineconeRouterMiddlewares) {\n\t\tlet plugin: any = window.PineconeRouterMiddlewares[i];\n\t\tif (plugin[func] == null) return;\n\t\tlet ret = plugin[func](...args);\n\t\t// the return of the function will only be 'stop'\n\t\t// if the middleware request stopping the navigate function.\n\t\tif (ret == 'stop') return 'stop';\n\t}\n}\n\n/**\n * @param {any} expression the expression to eval\n * @param {object} dataContext the alpine component data object\n * @param {object} additionalHelperVariables\n * @returns\n */\nexport function saferEval(\n\texpression: any,\n\tdataContext: object,\n\tadditionalHelperVariables: object = {}\n) {\n\t// eslint-disable-next-line no-new-func\n\treturn new Function(\n\t\t//@ts-ignore\n\t\t['$data', ...Object.keys(additionalHelperVariables)],\n\t\t`var __alpine_result; with($data) { __alpine_result = ${expression} }; return __alpine_result`\n\t)(dataContext, ...Object.values(additionalHelperVariables));\n}\n\n/**\n * execute the handlers of routes that are given passing them the context.\n * @param {array} handlers handlers to execute.\n * @param {object} context the current context to pass as argument.\n * @returns {boolean} false if the handler request a redirect.\n */\nexport function handle(handlers: Array<any>, context: object): boolean {\n\tif (handlers.length == 0) return true;\n\tfor (let i = 0; i < handlers.length; i++) {\n\t\tif (typeof handlers[i] == 'function') {\n\t\t\tlet result = handlers[i](context);\n\t\t\t// if the handler redirected, return\n\t\t\tif (result == 'stop') return false\n\t\t}\n\t}\n\treturn true;\n}\n\n/**\n * Convert to a URL object\n * https://github.com/visionmedia/page.js/blob/4f9991658f9b9e3de9b6059bade93693af24d6bd/page.js#L888\n */\nfunction toURL(href: string): URL | HTMLAnchorElement {\n\tif (typeof URL === 'function' && isLocation) {\n\t\treturn new URL(href, window.location.toString());\n\t} else {\n\t\tvar anc = window.document.createElement('a');\n\t\tanc.href = href;\n\t\treturn anc;\n\t}\n}\n\n/**\n * Check if `href` is the same origin.\n * https://github.com/visionmedia/page.js/blob/4f9991658f9b9e3de9b6059bade93693af24d6bd/page.js#L888\n */\nexport function sameOrigin(href: string) {\n\tif (!href || !isLocation) return false;\n\n\tvar url = toURL(href);\n\tvar loc = window.location;\n\n\t/*\n\tWhen the port is the default http port 80 for http, or 443 for\n\thttps, internet explorer 11 returns an empty string for loc.port,\n\tso we need to compare loc.port with an empty string if url.port\n\tis the default port 80 or 443.\n\tAlso the comparison with `port` is changed from `===` to `==` because\n\t`port` can be a string sometimes. This only applies to ie11.\n\t*/\n\treturn (\n\t\tloc.protocol === url.protocol &&\n\t\tloc.hostname === url.hostname &&\n\t\t(loc.port === url.port ||\n\t\t\t(loc.port === '' && (url.port == '80' || url.port == '443')))\n\t); // jshint ignore:line\n}\n\nexport function samePath(url: any) {\n\tif (!isLocation) return false;\n\tvar loc = window.location;\n\treturn url.pathname === loc.pathname && url.search === loc.search;\n}\n","import Route from './route';\nimport {\n\tbuildContext,\n\thandle,\n\tsameOrigin,\n\tsamePath,\n\tmiddleware,\n\tsaferEval,\n\tmatch,\n} from './utils';\n\nconst PineconeRouter = {\n\tversion: '0.3.0',\n\t/**\n\t * @type Array<Route>\n\t * @summary array of routes instantiated from the Route class.\n\t */\n\troutes: Array(),\n\n\tsettings: {\n\t\t/**\n\t\t * @type {boolean}\n\t\t * @summary enable hash routing\n\t\t */\n\t\thash: false,\n\t\t/**\n\t\t * @type {string}\n\t\t * @summary The base path of the site, for example /blog\n\t\t * Note: ignored when using hash routing.\n\t\t */\n\t\tbasePath: '/',\n\n\t\t/**\n\t\t * @type {boolean}\n\t\t * @summary may be set to true by a middleware that don't need handlers like x-views.\n\t\t */\n\t\tallowNoHandler: false,\n\t},\n\n\t/**\n\t * @type {string}\n\t * @summary detect click event, do not set manually.\n\t */\n\tclickEvent: document.ontouchstart ? 'touchstart' : 'click',\n\n\t/**\n\t * @type {object}\n\t * @summary The context object for current path.\n\t */\n\tcurrentContext: {},\n\n\t/**\n\t * @description The handler for 404 pages, can be overwritten by a notfound route\n\t * @param {object} context The context object.\n\t */\n\tnotfound: Array(),\n\n\t/**\n\t * Entry point of the plugin\n\t */\n\tstart() {\n\t\tif (!window.Alpine) {\n\t\t\tthrow new Error(\n\t\t\t\t'Alpine is required for `Pinecone Router` to work.'\n\t\t\t);\n\t\t}\n\n\t\t// Routers that are already initialized\n\t\tlet routerCount = 0;\n\n\t\t// Whenever a component is initialized, check if it is a router\n\t\t// and check if the children are valid routes\n\t\twindow.Alpine.onComponentInitialized((component: any) => {\n\t\t\tif (component.$el.hasAttribute('x-router')) {\n\t\t\t\tif (routerCount > 1) {\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t'Pinecone Router: Only one router can be in a page.'\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\t// Detect router settings\n\n\t\t\t\t// javascript config\n\t\t\t\t// this will check if there is a \"settings\" parameter\n\t\t\t\t// inside the router component's data.\n\t\t\t\tthis.settings = {\n\t\t\t\t\t...this.settings,\n\t\t\t\t\t...(component.getUnobservedData()['settings'] ?? {}),\n\t\t\t\t};\n\n\t\t\t\tmiddleware('init', component, this.settings);\n\n\t\t\t\t// Loop through child elements of this router\n\t\t\t\t// filtering out everything that isn't a template tag\n\t\t\t\t// and doesn't have x-route attribute.\n\t\t\t\tArray.from(component.$el.children)\n\t\t\t\t\t.filter((el: any) => el.tagName.toLowerCase() == 'template')\n\t\t\t\t\t.forEach((el: any) => this.processRoute(el, component));\n\n\t\t\t\trouterCount++;\n\n\t\t\t\tif (!this.settings.hash) {\n\t\t\t\t\t// navigate to the current page to handle it\n\t\t\t\t\t// ONLY if we not using hash routing for the default router\n\t\t\t\t\tthis.navigate(window.location.pathname, false, true);\n\t\t\t\t} else {\n\t\t\t\t\tif (window.location.hash == '') {\n\t\t\t\t\t\tdocument.location.href =\n\t\t\t\t\t\t\twindow.location.pathname + '#/';\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.navigate(\n\t\t\t\t\t\t\twindow.location.hash.substring(1),\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\ttrue\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Intercept click event in links\n\t\tthis.interceptLinks();\n\n\t\t// handle navigation events not emitted by links, for example, back button.\n\t\twindow.addEventListener('popstate', () => {\n\t\t\tif (this.settings.hash) {\n\t\t\t\tif (window.location.hash != '') {\n\t\t\t\t\tthis.navigate(window.location.hash.substring(1), true);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.navigate(window.location.pathname, true);\n\t\t\t}\n\t\t});\n\n\t\t// The $router magic helper\n\t\twindow.Alpine.addMagicProperty(\n\t\t\t'router',\n\t\t\t() => window.PineconeRouter.currentContext\n\t\t);\n\t},\n\t/**\n\t * Check if the anchor element point to a navigation route.\n\t * @param {any} el The anchor element or Event target\n\t * @param {boolean} hash Set to true when using hash routing\n\t * @returns {object} {valid: boolean, link: string}\n\t */\n\tvalidLink(el: any, hash: boolean): { valid: boolean; link: string } {\n\t\t// the object we'll return\n\t\tlet ret = { valid: false, link: '' };\n\n\t\t// The checks in this block are taken from\n\t\t// https://github.com/visionmedia/page.js/blob/master/index.js#L370\n\n\t\t// continue ensure link\n\n\t\t// el.nodeName for svg links are 'a' instead of 'A'\n\t\t// traverse up till we find an anchor tag, since clicks\n\t\t// on image links for example set the target as img instead of a.\n\t\twhile (el && 'A' !== el.nodeName.toUpperCase()) el = el.parentNode;\n\t\tif (!el || 'A' !== el.nodeName.toUpperCase()) return ret;\n\n\t\t// check if link is inside an svg\n\t\t// in this case, both href and target are always inside an object\n\t\tvar svg =\n\t\t\ttypeof el.href === 'object' &&\n\t\t\tel.href.constructor.name === 'SVGAnimatedString';\n\n\t\t// Ignore if tag has\n\t\t// 1. \"download\" attribute\n\t\t// 2. rel=\"external\" attribute\n\t\tif (\n\t\t\tel.hasAttribute('download') ||\n\t\t\tel.getAttribute('rel') === 'external'\n\t\t) {\n\t\t\treturn ret;\n\t\t}\n\n\t\t// ensure non-hash for the same path\n\t\tret.link = el.getAttribute('href') ?? '';\n\t\tif (!hash && samePath(el) && (el.hash || '#' === ret.link)) {\n\t\t\treturn ret;\n\t\t}\n\n\t\t// Check for mailto: in the href\n\t\tif (ret.link && ret.link.indexOf('mailto:') > -1) return ret;\n\n\t\t// check target\n\t\t// svg target is an object and its desired value is in .baseVal property\n\t\tif (svg ? el.target.baseVal : el.target) return ret;\n\n\t\t// x-origin\n\t\t// note: svg links that are not relative don't call click events (and skip page.js)\n\t\t// consequently, all svg links tested inside page.js are relative and in the same origin\n\t\tif (!svg && !sameOrigin(el.href)) return ret;\n\n\t\tret.valid = true;\n\t\treturn ret;\n\t},\n\n\t/**\n\t * Take the template element of a route and the router component\n\t * @param {HTMLTemplateElement} el the routes HTML element, must be a template tag.\n\t * @param {any} component the router Alpine component\n\t */\n\tprocessRoute(el: HTMLTemplateElement, component: any) {\n\t\t// The path must be a string\n\t\tlet path = el.getAttribute('x-route') ?? '/';\n\n\t\tif (path.indexOf('#') > -1) {\n\t\t\tthrow new Error(\n\t\t\t\t\"Pinecone Router: A route's path may not have a hash character.\"\n\t\t\t);\n\t\t}\n\n\t\tmiddleware('onBeforeRouteProcessed', el, component, path);\n\n\t\t// will hold handlers as functions\n\t\tlet handlers = [];\n\t\tif (\n\t\t\tel.hasAttribute('x-handler') == false &&\n\t\t\t!this.settings.allowNoHandler\n\t\t) {\n\t\t\tthrow new Error('Pinecone Router: Routes must have a handler.');\n\t\t} else if (el.hasAttribute('x-handler')) {\n\t\t\tlet result = saferEval(\n\t\t\t\tel.getAttribute('x-handler'),\n\t\t\t\tcomponent.$data\n\t\t\t);\n\n\t\t\tswitch (typeof result) {\n\t\t\t\t// a single function\n\t\t\t\tcase 'function':\n\t\t\t\t\thandlers = [result];\n\t\t\t\t\tbreak;\n\n\t\t\t\t// and array of functions\n\t\t\t\tcase 'object':\n\t\t\t\t\thandlers = result;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t`Pinecone Router: Invalid handler type: ${typeof result}.`\n\t\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (path == 'notfound') {\n\t\t\t\t// register the handlers for the notfound route\n\t\t\t\tthis.notfound = handlers;\n\t\t\t}\n\t\t}\n\n\t\tif (path != 'notfound') {\n\t\t\t// if specified add the basePath but only if not using hash routing\n\t\t\tif (this.settings.basePath != '/' && !this.settings.hash) {\n\t\t\t\tpath = this.settings.basePath + path;\n\t\t\t}\n\n\t\t\t// register the new route if possible\n\t\t\tthis.addRoute(path, handlers);\n\t\t}\n\t},\n\n\t/**\n\t * @description Add a handler to click events on all valid links\n\t */\n\tinterceptLinks() {\n\t\tvar t = this;\n\t\twindow.document.body.onclick = function (e: any) {\n\t\t\tif (\n\t\t\t\te.metaKey ||\n\t\t\t\te.ctrlKey ||\n\t\t\t\te.shiftKey ||\n\t\t\t\te.detail != 1 ||\n\t\t\t\te.defaultPrevented\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// ensure link\n\t\t\t// use shadow dom when available if not, fall back to composedPath()\n\t\t\t// for browsers that only have shady\n\t\t\tlet el = e.target;\n\n\t\t\tlet eventPath =\n\t\t\t\te.path || (e.composedPath ? e.composedPath() : null);\n\n\t\t\tif (eventPath) {\n\t\t\t\tfor (let i = 0; i < eventPath.length; i++) {\n\t\t\t\t\tif (!eventPath[i].nodeName) continue;\n\t\t\t\t\tif (eventPath[i].nodeName.toUpperCase() !== 'A') continue;\n\t\t\t\t\tif (!eventPath[i].href) continue;\n\n\t\t\t\t\tel = eventPath[i];\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// allow skipping handler\n\t\t\tif (el.hasAttribute('native')) return;\n\n\t\t\tlet ret = t.validLink(el, t.settings.hash);\n\t\t\tif (!ret.valid) return;\n\t\t\tt.navigate(ret.link);\n\n\t\t\t// prevent default behavior.\n\t\t\te.preventDefault();\n\t\t};\n\t},\n\n\t/**\n\t *  Go to the specified path without reloading\n\t * @param {string} path the path with no hash even if using hash routing\n\t * @param {boolean} fromPopState this will be set to true if called from window.onpopstate event\n\t * @param {boolean} firstLoad this will be set to true if this is the first page loaded, also from page reload\n\t */\n\tnavigate(\n\t\tpath: string,\n\t\tfromPopState: boolean = false,\n\t\tfirstLoad: boolean = false\n\t) {\n\t\tpath ??= '/';\n\n\t\t// only add basePath if it was set\n\t\t// if not using hash routing\n\t\t// and if it wasn't added already\n\t\tif (\n\t\t\tthis.settings.basePath != '/' &&\n\t\t\t!this.settings.hash &&\n\t\t\tpath.indexOf(this.settings.basePath) != 0\n\t\t) {\n\t\t\tpath = this.settings.basePath + path;\n\t\t}\n\n\t\tif (path == this.settings.basePath && !path.endsWith('/')) {\n\t\t\tpath += '/';\n\t\t}\n\n\t\tconst route: Route | undefined = this.routes.find((route: Route) => {\n\t\t\tlet m = match(path, route.path);\n\t\t\tif (m) {\n\t\t\t\troute.params = m;\n\t\t\t\treturn true;\n\t\t\t}\n\t\t});\n\n\t\tlet notfound = route == undefined;\n\t\tlet context =\n\t\t\ttypeof route == 'undefined'\n\t\t\t\t? buildContext('notfound', path, [])\n\t\t\t\t: buildContext(route.path, path, route.params);\n\n\t\tthis.currentContext = context;\n\n\t\t// the middleware may return false to stop execution\n\t\tif (\n\t\t\tmiddleware(\n\t\t\t\t'onBeforeHandlersExecuted',\n\t\t\t\troute,\n\t\t\t\tpath,\n\t\t\t\tfirstLoad,\n\t\t\t\tnotfound\n\t\t\t) == 'stop'\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\t// do not call pushstate from popstate event https://stackoverflow.com/a/50830905\n\t\tif (!fromPopState) {\n\t\t\tlet fullPath = '';\n\n\t\t\tif (this.settings.hash) {\n\t\t\t\tfullPath = '#';\n\t\t\t\tif (window.location.pathname != '/') {\n\t\t\t\t\tfullPath += window.location.pathname;\n\t\t\t\t}\n\t\t\t\tfullPath += window.location.search + path;\n\t\t\t} else {\n\t\t\t\tfullPath = path + window.location.search + window.location.hash;\n\t\t\t}\n\n\t\t\thistory.pushState({ path: fullPath }, '', fullPath);\n\t\t}\n\n\t\tif (route && route.handlers != []) {\n\t\t\t// will only be false when returning context.redirect().\n\t\t\t// so redirect without finishing\n\t\t\tif (!handle(route.handlers, context)) return; \n\t\t} else if (notfound && this.notfound != null) {\n\t\t\tif (!handle(this.notfound, context)) return;\n\t\t}\n\n\t\tmiddleware('onHandlersExecuted', route, path, firstLoad, notfound);\n\t},\n\n\t/**\n\t * Add a new route\n\t * @param {string} path\n\t * @param {array} handlers array of functions\n\t */\n\taddRoute(path: string, handlers: Array<any>) {\n\t\t// check if the route was registered on the same router.\n\t\tif (this.routes.find((r: Route) => r.path == path) != null) {\n\t\t\tthrow new Error('Pinecone Router: route already exist');\n\t\t}\n\n\t\tthis.routes.push(new Route(path, handlers));\n\t},\n\n\t/**\n\t * Remove a route\n\t * @param {string} path\n\t */\n\tremoveRoute(path: string) {\n\t\tthis.routes = this.routes.filter((r: Route) => r.path != path);\n\t},\n};\n\nconst alpine =\n\twindow.deferLoadingAlpine || ((callback: Function) => callback());\n\nwindow.PineconeRouter = PineconeRouter;\n\nwindow.deferLoadingAlpine = function (callback: Function) {\n\twindow.PineconeRouter.start();\n\n\talpine(callback);\n};\n\ndeclare global {\n\tinterface Window {\n\t\tAlpine: any;\n\t\tdeferLoadingAlpine: any;\n\t\tPineconeRouter: typeof PineconeRouter;\n\t\tPineconeRouterMiddlewares: Array<Object>;\n\t}\n}\n\nexport default PineconeRouter;\n"],"names":["Route","path","handlers","this","isLocation","window","location","buildContext","route","params","query","search","substring","hash","redirect","PineconeRouter","navigate","segmentize","url","replace","split","middleware","func","PineconeRouterMiddlewares","i","plugin","ret","handle","context","length","version","routes","Array","settings","basePath","allowNoHandler","clickEvent","document","ontouchstart","currentContext","notfound","start","Alpine","Error","routerCount","onComponentInitialized","component","$el","hasAttribute","_this","getUnobservedData","from","children","filter","el","tagName","toLowerCase","forEach","processRoute","href","pathname","interceptLinks","addEventListener","addMagicProperty","validLink","valid","link","nodeName","toUpperCase","parentNode","svg","constructor","name","getAttribute","loc","samePath","indexOf","target","baseVal","URL","toString","anc","createElement","toURL","protocol","hostname","port","sameOrigin","expression","dataContext","additionalHelperVariables","result","$data","Function","Object","keys","values","addRoute","t","body","onclick","e","metaKey","ctrlKey","shiftKey","detail","defaultPrevented","eventPath","composedPath","preventDefault","fromPopState","firstLoad","endsWith","find","m","routePath","reg","c","match","matches","p","r","decodeURIComponent","slice","join","urlSeg","max","Math","charAt","param","flags","plus","star","val","map","undefined","fullPath","history","pushState","push","removeRoute","alpine","deferLoadingAlpine","callback"],"mappings":"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"}