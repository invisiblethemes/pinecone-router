class t{constructor(t,e,r){this.path=t,this.handler=e,this.router=r}setProps(t){this.props=t}handle(){return this.handler({props:this.props,path:this.path})}}class e{constructor(t,e){this.name=t,this.settings=e}}const r={isLocation:!(!window.history.location&&!window.location),validLink(t){for(;t&&"A"!==t.nodeName.toUpperCase();)t=t.parentNode;if(!t||"A"!==t.nodeName.toUpperCase())return!1;var e="object"==typeof t.href&&"SVGAnimatedString"===t.href.constructor.name;if(t.hasAttribute("download")||"external"===t.getAttribute("rel"))return!1;var r=t.getAttribute("href");return!(r&&r.indexOf("mailto:")>-1||(e?t.target.baseVal:t.target)||!e&&!this.sameOrigin(t.href))},match(t,e){let r=[],n=t.path.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&").replace(/([:^\s])(\w+)/g,(t,e,n)=>(r.push(n),"([^/]+)"))+"(?:/|$)",o={},i=e.match(new RegExp(n));if(null!==i){if(0!=i.index)return null;if(i.input!=i[0])return null;o=i.slice(1).reduce((t,e,n)=>(null===t&&(t={}),t[r[n]]=e,t),null)}return t.setProps(o),i},toURL(t){if("function"==typeof URL&&this.isLocation)return new URL(t,window.location.toString());var e=window.document.createElement("a");return e.href=t,e},sameOrigin(t){if(!t||!this.isLocation)return!1;var e=this.toURL(t),r=window.location;return r.protocol===e.protocol&&r.hostname===e.hostname&&(r.port===e.port||""===r.port&&(80==e.port||443==e.port))},samePath(t){if(!this.isLocation)return!1;var e=window.location;return t.pathname===e.pathname&&t.search===e.search},detectRouterSettings(t){let e={};if(t.hasAttribute("x-base")&&(e.base=t.getAttribute("x-base")),t.hasAttribute("x-render")){let r=t.getAttribute("x-render");e.render=""==r?"body":r}return e}},n={routes:[],routers:[],settings:{interceptLinks:!0,basepath:"/",hash:!1},loaded:!1,notfound:function(t){console.error(`Alpine Router: requested path ${t} was not found`)},start(){if(!window.Alpine)throw new Error("Alpine is require for `Alpine Router` to work.");this.routerloaded=new Event("routerloaded"),this.loadstart=new Event("loadstart"),this.loadend=new Event("loadend");let t=document.querySelectorAll("[x-data][x-router]").length,n=0;Alpine.onComponentInitialized(o=>{if(o.$el.hasAttribute("x-router")){let i=o.$el.getAttribute("x-router");if("string"!=typeof i&&(console.warn("Alpine Router: x-router attribute should be a string of the router name or empty for default"),i="default"),""==i&&(i="default",o.$el.setAttribute("x-router",i)),"string"!=typeof i&&(console.warn("Alpine Router: x-router attribute should be a string of the router name or empty for default"),i="default"),this.routers.findIndex(t=>t.name==i)>-1)throw new Error(`Alpine Router: A router with the name ${i} already exist. Use a different name by setting the attribute x-router to another value`);let a=r.detectRouterSettings(o.$el);if(Array.from(o.$el.children).forEach(t=>{t.hasAttribute("x-route")&&this.processRoute(t,o,i,a)}),this.routers.push(new e(i,a)),n++,n==t){if(this.settings.hash){if(""==window.location.hash)return void(document.location.href=window.location.pathname+"#/");this.navigate(window.location.hash.substring(1),!0)}else this.navigate(window.location.pathname);this.loaded=!0,window.dispatchEvent(this.routerloaded)}}}),this.settings.interceptLinks?document.querySelectorAll("a").forEach(t=>{0!=r.validLink(t)&&t.addEventListener("click",t=>{t.preventDefault();let e=t.target.getAttribute("href");this.settings.hash?window.location.hash="#"+e:this.navigate(e)},!1)}):document.querySelectorAll("a[x-link]").forEach(t=>{t.addEventListener("click",t=>{t.preventDefault();let e=t.target.getAttribute("href");this.navigate(e)},!1)}),window.addEventListener("popstate",()=>{this.settings.hash?""!=window.location.hash&&this.navigate(window.location.hash.substring(1),!0):this.navigate(window.location.pathname,!0)})},processRoute(e,n,o,i){if("template"!==e.tagName.toLowerCase())throw new Error("Alpine Router: x-route must be used on a template tag.");if(0==e.hasAttribute("x-handler"))throw new Error('Alpine Router: x-route must have a handler (x-handler="handler")');let a=e.getAttribute("x-route");if("string"!=typeof a)throw new Error(`Alpine Router: x-route must be a string, ${typeof a} given.`);if(a.indexOf("#")>-1)throw new Error("Alpine Router: A route's path may not have a hash, setting AlpineRouter.settings.hash to true is sufficiant.");let s,h=e.getAttribute("x-handler");try{s=n.getUnobservedData()[h]}catch(t){throw new Error("Alpine Router: "+t)}if("function"!=typeof s)throw new Error(`Alpine Router: handler must be a callback function, ${typeof s} given.`);if("notfound"==a)this.notfound=s;else{if(0==["/","#/"].includes(this.settings.basepath)&&(a=this.settings.basepath+a),null!=i.base&&(a=i.base+a),1==this.routes.filter(t=>r.match(t,a)).forEach(t=>{if(t.router==o)return!0}))throw new Error("Alpine Router: Route `${path}` is already registered on router `${routerName}`.");this.routes.push(new t(a,s,o))}},navigate(t,e=!1){window.dispatchEvent(this.loadstart),null==t&&(t="/");const n=this.routes.filter(e=>r.match(e,t));if(0==n.length&&this.notfound(t),!e){let e;e=this.settings.hash?window.location.pathname+window.location.search+t:t+window.location.search+window.location.hash,history.pushState({path:e},"",e)}let o;n.forEach(e=>{let r=this.routers.find(t=>t.name==e.router);if(null!=r.settings.render){let e=r.settings.render;null==o&&fetch(t).then(t=>t.text()).then(t=>{o=(new DOMParser).parseFromString(t,"text/html"),console.log(t),document.querySelector(e).innerHTML=o.querySelector(e).innerHTML})}e.handle()}),window.dispatchEvent(this.loadend)}},o=window.deferLoadingAlpine||(t=>t());window.AlpineRouter=n,window.deferLoadingAlpine=function(t){window.AlpineRouter.start(),o(t)};export default n;
//# sourceMappingURL=alpine-router.module.js.map
