{"version":3,"file":"alpine-router.module.js","sources":["../src/route.js","../src/utils.js","../src/index.js"],"sourcesContent":["class Route {\n\tconstructor(path, handler, router) {\n\t\tthis.path = path;\n\t\tthis.handler = handler;\n\t\tthis.router = router;\n\t}\n\n\tsetProps(newProps) {\n\t\tthis.props = newProps;\n\t}\n\n\thandle() {\n\t\treturn this.handler(this.props);\n\t}\n}\n\nexport default Route;","const utils = {\n\tisLocation: !!(window.history.location || window.location),\n\tvalidLink(el) {\n\t\t// The checks in this block are taken from page.js https://github.com/visionmedia/page.js/blob/master/index.js#L370\n\t\t// el.nodeName for svg links are 'a' instead of 'A'\n\t\twhile (el && 'A' !== el.nodeName.toUpperCase()) el = el.parentNode;\n\t\tif (!el || 'A' !== el.nodeName.toUpperCase()) return false;\n\n\t\t// check if link is inside an svg\n\t\t// in this case, both href and target are always inside an object\n\t\tvar svg =\n\t\t\ttypeof el.href === 'object' &&\n\t\t\tel.href.constructor.name === 'SVGAnimatedString';\n\n\t\t// Ignore if tag has\n\t\t// 1. \"download\" attribute\n\t\t// 2. rel=\"external\" attribute\n\t\tif (\n\t\t\tel.hasAttribute('download') ||\n\t\t\tel.getAttribute('rel') === 'external'\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\tvar link = el.getAttribute('href');\n\n\t\t// Check for mailto: in the href\n\t\tif (link && link.indexOf('mailto:') > -1) return false;\n\n\t\t// check target\n\t\t// svg target is an object and its desired value is in .baseVal property\n\t\tif (svg ? el.target.baseVal : el.target) return false;\n\n\t\t// x-origin\n\t\t// note: svg links that are not relative don't call click events (and skip page.js)\n\t\t// consequently, all svg links tested inside page.js are relative and in the same origin\n\t\tif (!svg && !this.sameOrigin(el.href)) return false;\n\n\t\treturn true;\n\t},\n\t/**\n\t * Match the path with specified routes\n\t * https://github.com/vijitail/simple-javascript-router/blob/master/src/router/Router.js#L14\n\t */\n\tmatch(route, requestPath) {\n\t\tlet paramNames = [];\n\t\tlet regexPath =\n\t\t\troute.path.replace(/([:*])(\\w+)/g, (_full, _colon, name) => {\n\t\t\t\tparamNames.push(name);\n\t\t\t\treturn '([^/]+)';\n\t\t\t}) + '(?:/|$)';\n\n\t\tlet params = {};\n\t\tlet routeMatch = requestPath.match(new RegExp(regexPath));\n\t\tif (routeMatch !== null) {\n\t\t\tparams = routeMatch.slice(1).reduce((params, value, index) => {\n\t\t\t\tif (params === null) params = {};\n\t\t\t\tparams[paramNames[index]] = value;\n\t\t\t\treturn params;\n\t\t\t}, null);\n\t\t}\n\n\t\troute.setProps(params);\n\n\t\treturn routeMatch;\n\t},\n\t/**\n\t * Convert to a URL object\n\t * https://github.com/visionmedia/page.js/blob/4f9991658f9b9e3de9b6059bade93693af24d6bd/page.js#L888\n\t */\n\ttoURL(href) {\n\t\tif (typeof URL === 'function' && this.isLocation) {\n\t\t\treturn new URL(href, window.location.toString());\n\t\t} else {\n\t\t\tvar anc = window.document.createElement('a');\n\t\t\tanc.href = href;\n\t\t\treturn anc;\n\t\t}\n\t},\n\n\t/**\n\t * Check if `href` is the same origin.\n\t * https://github.com/visionmedia/page.js/blob/4f9991658f9b9e3de9b6059bade93693af24d6bd/page.js#L888\n\t */\n\tsameOrigin(href) {\n\t\tif (!href || !this.isLocation) return false;\n\n\t\tvar url = this.toURL(href);\n\t\tvar loc = window.location;\n\n\t\t/*\n\t\t   When the port is the default http port 80 for http, or 443 for\n\t\t   https, internet explorer 11 returns an empty string for loc.port,\n\t\t   so we need to compare loc.port with an empty string if url.port\n\t\t   is the default port 80 or 443.\n\t\t   Also the comparition with `port` is changed from `===` to `==` because\n\t\t   `port` can be a string sometimes. This only applies to ie11.\n\t\t*/\n\t\treturn (\n\t\t\tloc.protocol === url.protocol &&\n\t\t\tloc.hostname === url.hostname &&\n\t\t\t(loc.port === url.port ||\n\t\t\t\t(loc.port === '' && (url.port == 80 || url.port == 443)))\n\t\t); // jshint ignore:line\n\t},\n\tsamePath(url) {\n\t\tif (!this.isLocation) return false;\n\t\tvar loc = window.location;\n\t\treturn url.pathname === loc.pathname && url.search === loc.search;\n\t},\n};\n\nexport default utils;\n","import Route from './route.js';\nimport utils from './utils.js';\n\nconst AlpineRouter = {\n\troutes: [],\n\tsettings: [],\n\tloading: false,\n\tnotfound: function () {\n\t\tconsole.log('Alpine Router: not found');\n\t},\n\n\tstart() {\n\t\tif (!window.Alpine) {\n\t\t\tthrow new Error('Alpine is require for `Alpine Router` to work.');\n\t\t}\n\t\tconst loadstarted = new Event('loadstarted');\n\t\tconst loadended = new Event('loadended');\n\t\tconst pagechanged = new Event('pagechanged');\n\n\t\t// Get the amout of routers in the page at load.\n\t\t// However routers may be added dynamically and they will also be setup.\n\t\t// This is only to detect all routers currently loaded are initialized\n\t\t// in order to process the current page.\n\t\tlet routerCount = document.querySelectorAll('[x-data][x-router]')\n\t\t\t.length;\n\n\t\t// Routers that are already set up\n\t\tlet currentRouterCount = 0;\n\n\t\t// Whenever a component is initialized, check if it is a router\n\t\t// and run test the children if they're valid routes\n\t\tAlpine.onComponentInitialized((component) => {\n\t\t\tif (component.$el.hasAttribute('x-router')) {\n\n\t\t\t\t// take the router name if specified\n\t\t\t\tlet routerName = component.$el.getAttribute('x-router');\n\t\t\t\tif (typeof routerName != 'string') {\n\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t'Alpine Router: x-router attribute should be a string of the router name or empty for default'\n\t\t\t\t\t);\n\t\t\t\t\trouterName = 'default';\n\t\t\t\t} if (routerName == '') {\n\t\t\t\t\trouterName = 'default';\n\t\t\t\t}\n\n\t\t\t\t// Loop through routes of this router\n\t\t\t\tArray.from(component.$el.children).forEach((el) => {\n\t\t\t\t\tif (el.hasAttribute('x-route')) {\n\t\t\t\t\t\tthis.processRoute(el, component, routerName);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\tcurrentRouterCount++;\n\t\t\t\t// this will run when all routers are set up\n\t\t\t\t// in order to handle the current page\n\t\t\t\tif (currentRouterCount == routerCount) {\n\t\t\t\t\tconsole.log({ routerCount });\n\t\t\t\t\t// navigate to the current page to handle it\n\t\t\t\t\tthis.navigate(location.pathname + location.hash);\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\n\t\t// Intercept click event in links\n\t\tdocument.querySelectorAll('a').forEach((el) => {\n\t\t\t// check if the link should watched for click events.\n\t\t\tif (utils.validLink(el) == false) return;\n\n\t\t\tel.addEventListener(\n\t\t\t\t'click',\n\t\t\t\t(e) => {\n\t\t\t\t\te.preventDefault();\n\t\t\t\t\tthis.navigate(e.target.getAttribute('href'));\n\t\t\t\t},\n\t\t\t\tfalse\n\t\t\t);\n\t\t});\n\n\t\t// handle navigation events not emitted by links, for exmaple, back button.\n\t\twindow.addEventListener('popstate', (e) => this.navigate(e.detail));\n\t},\n\n\t/**\n\t * Take the template element of a route and the router component\n\t * and test if it can be added or not\n\t */\n\tprocessRoute(el, component, routerName) {\n\t\tif (el.tagName.toLowerCase() !== 'template') {\n\t\t\tthrow new Error(\n\t\t\t\t'Alpine Router: x-route must be used on a template tag.'\n\t\t\t);\n\t\t}\n\n\t\tif (el.hasAttribute('x-handler') == false) {\n\t\t\tthrow new Error(\n\t\t\t\t'Alpine Router: x-route must have a handler (x-handler=\"handler\")'\n\t\t\t);\n\t\t}\n\n\t\tlet path = el.getAttribute('x-route');\n\t\tlet handlerName = el.getAttribute('x-handler');\n\t\tlet handler = component.getUnobservedData()[handlerName];\n\n\t\tif (path == 'notfound') {\n\t\t\t// register the route as a 404 handlerconsole.warn(\n\t\t\tthis.notfound = handler;\n\t\t} else {\n\t\t\t// check if the route was registered on the same router.\n\t\t\t// this allow having multiple routers with the same route\n\t\t\t// for example a router for navigation and router for content\n\t\t\tlet routeExist = this.routes.filter((route) =>\n\t\t\t\tthis.match(route, path)\n\t\t\t).forEach((e) => {\n\t\t\t\tif (e.routerName == routerName) return true\n\t\t\t});\n\t\t\tif (routeExist) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t'Alpine Router: Route `${path}` is already registered on router `${routerName}`.'\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// register the new route.\n\t\t\t\tthis.routes.push(new Route(path, handler, routerName));\n\t\t\t}\n\t\t}\n\t},\n\n\t/**\n\t * Go to the specified path without reloading\n\t * Based on https://github.com/vijitail/simple-javascript-router/blob/master/src/router/Router.js#L37\n\t */\n\tnavigate(path) {\n\t\tconst routes = this.routes.filter((route) => this.match(route, path));\n\t\tif (!routes) this.notfound();\n\t\telse {\n\t\t\t// handle many routes for different routers\n\t\t\t// but only push the route once to history\n\t\t\thistory.pushState({}, '', path);\n\t\t\troutes.forEach((route) => route.handle());\n\t\t}\n\t},\n};\n\nconst alpine = window.deferLoadingAlpine || ((callback) => callback());\n\nwindow.AlpineRouter = AlpineRouter;\n\nwindow.deferLoadingAlpine = function (callback) {\n\twindow.AlpineRouter.start();\n\n\talpine(callback);\n};\n\nexport default AlpineRouter;\n"],"names":["Route","constructor","path","handler","router","this","setProps","newProps","props","handle","utils","isLocation","window","history","location","validLink","el","nodeName","toUpperCase","parentNode","svg","href","name","hasAttribute","getAttribute","link","indexOf","target","baseVal","sameOrigin","match","route","requestPath","paramNames","regexPath","replace","_full","_colon","push","params","routeMatch","RegExp","slice","reduce","value","index","toURL","URL","toString","anc","document","createElement","url","loc","protocol","hostname","port","samePath","pathname","search","AlpineRouter","routes","settings","loading","notfound","console","log","start","Alpine","Error","Event","routerCount","querySelectorAll","length","currentRouterCount","onComponentInitialized","component","$el","routerName","warn","Array","from","children","forEach","processRoute","navigate","hash","addEventListener","e","preventDefault","detail","tagName","toLowerCase","handlerName","getUnobservedData","filter","pushState","alpine","deferLoadingAlpine","callback"],"mappings":"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"}